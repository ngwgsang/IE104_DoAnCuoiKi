import{initializeApp}from"https://www.gstatic.com/firebasejs/9.1.3/firebase-app.js";import{getDatabase,set,get,ref,child,update,remove}from"https://www.gstatic.com/firebasejs/9.1.3/firebase-database.js";import{getAuth,createUserWithEmailAndPassword,signInWithEmailAndPassword,signOut}from"https://www.gstatic.com/firebasejs/9.1.3/firebase-auth.js";const firebaseConfig={apiKey:"AIzaSyDBFDnIU7btsKCP6PG-T6X2EekhreOYMSw",authDomain:"oishii-pizza.firebaseapp.com",databaseURL:"https://oishii-pizza-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"oishii-pizza",storageBucket:"oishii-pizza.appspot.com",messagingSenderId:"70572006035",appId:"1:70572006035:web:88dc7f487acab764dfcb66"},app=initializeApp(firebaseConfig),db=getDatabase(app);var cur,auth=getAuth(app);const dbref=ref(db);function fetchData(e){get(child(dbref,e+"/_overview")).then(e=>{document.getElementById("account--name").innerText=e.val()._name,document.getElementById("ACCOUNT--name").innerText=e.val()._name,document.getElementById("overview--name").innerText=e.val()._name,document.getElementById("overview--email").innerText=e.val()._email,document.getElementById("overview--phone").innerText=e.val()._phone}).catch(e=>{alert("LỖI"+e)}),get(child(dbref,e+"/_history")).then(e=>{var t=[];e.forEach(e=>{t.push(e.val())}),t.forEach(e=>{document.getElementById("history--list").innerHTML+=`
        <li>
        <span>${e._bill_id}</span>
        <span>${e._bill_name}</span>
        <span>${e._bill_time}</span>
        <span>${e._bill_price}</span>
        <span>${e._bill_status}</span>
        </li>
        `})}).catch(()=>{alert("LỖI"+error)}),get(child(dbref,e+"/_address")).then(e=>{var t=[];e.forEach(e=>{t.push(e.val())}),t.forEach(e=>{1==e._default?(document.getElementById("default_address--name").innerText=e._name,document.getElementById("default_address--address").innerText=e._home_address,document.getElementById("default_address--phone").innerText=e._phone):document.getElementById("address--list").innerHTML+=`
          <li class="address">
            <ul>
              <li>Họ tên: <span>${e._name}</span></li>
              <li>Địa chỉ: <span></span>${e._home_address}</li>
              <li>Số điện thoại: <span>${e._phone}</span></li>
            </ul>
          </li>
          `})}),get(child(dbref,e+"/_voucher")).then(e=>{var t=[];e.forEach(e=>{t.push(e.val())}),document.getElementById("voucher--list").innerHTML="",t.forEach(e=>{let t;1==e._voucher_status&&(t="Chưa sử dụng"),2==e._voucher_status&&(t="Đã sử dụng"),3==e._voucher_status&&(t="Đã hết hạn"),document.getElementById("voucher--list").innerHTML+=`
          <li>
              <span>${e._voucher_id}</span>
              <span>${e._voucher_description}</span>
              <span>${e._voucher_exp}</span>
              <span>${t}</span>
          </li>
          `})})}function clearData(){document.getElementById("default_address--name").innerText="",document.getElementById("default_address--address").innerText="",document.getElementById("default_address--phone").innerText="",document.getElementById("address--list").innerText="",document.getElementById("voucher--list").innerText="",document.getElementById("history--list").innerText="",document.getElementById("account--name").innerText="",document.getElementById("overview--name").innerText="",document.getElementById("overview--email").innerText="",document.getElementById("overview--phone").innerText=""}document.getElementById("LOGIN-BTN").addEventListener("click",()=>{const e=document.getElementById("login__email").value;var t=document.getElementById("login__password").value;console.log(e.match(/^[^ ]+@[^ ]+\.[a-z]{2,3}$/)),signInWithEmailAndPassword(auth,e,t).catch(e=>{toast({title:"Thất bại!",message:"Email hoặc password không đúng!",type:"error",duration:3e3});e.code,e.message}).then(e=>{e.user;fetchData(auth.currentUser.uid),toast({title:"Thành công!",message:"Bạn đã đăng nhập thành công tài khoản tại Oishii Pizza!",type:"success",duration:3e3}),document.getElementById("nav__LOGIN").style.display="none",document.getElementById("nav__ACCOUNT").style.display="flex",document.getElementById("LOGIN").style.display="none",document.getElementById("HOME").style.display="flex",document.querySelector(".account-config").style.display="flex"})}),document.getElementById("SIGNUP-BTN").addEventListener("click",()=>{const t=document.getElementById("signup__email").value;var e=document.getElementById("signup__password").value,n=document.getElementById("signup__password__confirm").value;const a=document.getElementById("signup__name").value,s=document.getElementById("signup__phone").value;var i=/^[^ ]+@[^ ]+\.[a-z]{2,3}$/;console.log(t.match(i)),t.match(i)&&""!=e&&e!=n?toast({title:"Thất bại!",message:"Vui lòng kiểm tra phần nhập mật khẩu",type:"error",duration:3e3}):createUserWithEmailAndPassword(auth,t,e).catch(e=>{e.code,e.message;toast({title:"Thất bại!",message:"Email này đã tồn tại",type:"error",duration:3e3})}).then(e=>{e=e.user;set(ref(db,e.uid+"/_overview"),{_email:t,_name:a,_phone:s}).then(()=>{toast({title:"Thành công!",message:`Chào mừng ${t} đến với Oishii Pizza Việt Nam!`,type:"success",duration:3e3}),console.log("Tạo branch thành công")}).catch(e=>{console.log("Tạo branch không thành công, Lỗi: "+e)})})}),document.getElementById("LOGOUT-BTN").addEventListener("click",()=>{document.getElementById("nav__LOGIN").style.display="flex",document.getElementById("LOGIN").style.display="flex",document.getElementById("ACCOUNT").style.display="none",document.getElementById("nav__ACCOUNT").style.display="none",document.querySelector(".account-config").style.display="none";document.getElementById("signup__email").value,document.getElementById("signup__password").value;clearData(),signOut(auth).then(()=>{toast({title:"Thành công!",message:"Bạn đã đăng xuất, hẹn gặp lại!",type:"success",duration:3e3})}).catch(e=>{})});